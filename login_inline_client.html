<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login (Test)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto;max-width:720px;margin:24px auto;padding:0 16px}
  form,.card{border:1px solid #ddd;border-radius:12px;padding:16px;margin:16px 0}
  input{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px}
  button{padding:10px 14px;border-radius:10px;border:1px solid #ddd;cursor:pointer}
  pre{background:#f7f7f7;padding:12px;border-radius:10px;overflow:auto}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
</style>
</head>
<body>
<h1>Login (Test)</h1>

<div class="card">
  <div class="row">
    <button type="button" onclick="alert('click OK')">Click test</button>
    <small>← 反応すればイベントOK</small>
  </div>
</div>

<div class="card">
  <form id="login">
    <label>メール</label>
    <input name="email" type="email" required placeholder="you@example.com" />
    <label>パスワード</label>
    <input name="password" type="password" required placeholder="••••••••" />
    <div class="row">
      <button type="button" onclick="signIn()">Sign in</button>
      <button type="button" onclick="signOut()">Sign out</button>
    </div>
  </form>
</div>

<div class="card">
  <strong>現在の状態</strong>
  <pre id="status">loading...</pre>
</div>

<!-- ESMではなくUMDを使用（環境依存の無反応を回避） -->
<script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<script>
  // ★ここをあなたのプロジェクトの実値に置換（2か所）
  const SUPABASE_URL  = "https://cqiqhczxuiyakptdjowr.supabase.co";
  const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNxaXFoY3p4dWl5YWtwdGRqb3dyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NzAwNzMsImV4cCI6MjA3MzM0NjA3M30.vCFQoQnsClINKa5tQAz-rNnF5XLEukmn_Nl0Err5k3k";

  // UMD: グローバル window.supabase
  const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
    auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: false }
  });

  const $ = (id)=>document.getElementById(id);
  function show(obj){ $('status').textContent = JSON.stringify(obj, null, 2); }

  async function refresh(){
    const { data:{ session } } = await client.auth.getSession();
    const user = session?.user ?? null;
    show({ user: user ? { id:user.id, email:user.email } : null });
  }

  async function signIn(){
    try{
      const email = document.querySelector('[name=email]').value.trim();
      const password = document.querySelector('[name=password]').value;
      if(!email || !password){ alert("メール/パスワードを入れてください"); return; }
      await client.auth.signOut(); // 念のため初期化
      const { error } = await client.auth.signInWithPassword({ email, password });
      if(error){ alert("Sign in error: " + error.message); return; }
      await refresh(); alert("Signed in");
    }catch(e){ console.error(e); alert("JS error: " + (e.message||e)); }
  }

  async function signOut(){
    await client.auth.signOut();
    await refresh(); alert("Signed out");
  }

  // 初期表示
  refresh();
</script>
</body>
</html>
