




==========================================================
0828夜の改修点整理

A. 走行フロー & UI
▶ 記録開始＝GPS起動＋記録開始＋追従ON（ワンタップ開始）
🔁 追従はデフォルトON／地図ドラッグで自動OFF／ボタンで手動ON/OFF
✏️ 編集モード分離（記録中は自動ロック／タップで点追加禁止）
■ 停止→保存確認ダイアログ（保存／破棄／キャンセル）
保存OK後はホームへ遷移し、「実走ログ」タブを前面＋新規ログを先頭表示＆ハイライト
（補助）📍は残すが「現在地だけ見たい」用途向け
B. ホーム画面（一覧）
タブ構成：ルート / 実走ログ
実走ログ一覧：名前 · 日付 · 距離 · 時間 · （紐付ルート名） [開く] [削除]
[開く]でリプレイ表示（赤=実走、青=元ルート）
ルート一覧は表示のみ（新規描画は今回は保留）
C. ログ保存の軽量化（保存時に自動適用）
クレンジング：accuracy > 100m除外／2m未満の重複点除外
平滑化：3点移動平均（既定ON）
簡略化：Douglas–Peucker（既定=6m、高精度=3m）
距離リサンプリング：5m間隔（標準）／3m（高精度）
符号化保存：Encoded Polyline（軽量版として保存）
メタ：pointCount, lengthMeters, durationSec, bbox を保存
UIの保存ダイアログに 精度プロファイル を用意
既定：標準（6m/5m/平滑ON）
切替：高精度（3m/3m/平滑ON）（将来Proに紐付け可）
D. データモデル & 保存先
IndexedDB に移行（localStorageはやめる）
routes: id, name, coords|polyline, lengthMeters, updatedAt, origin
logs: id, routeId|null, name, startedAt, endedAt, coords|polyline, distanceMeters, durationSec
命名規則：
ルート：YYYY-MM-DD ルート 01
ログ：YYYY-MM-DD 実走 01（同日連番）
（将来）ログ→ルート昇格ボタンをログ詳細に追加
E. GPSサンプリング（実走中）
enableHighAccuracy:true, maximumAge:0, timeout:20000
精度条件：accuracy <= 100m
最小移動距離：3m
取り込み間隔：1秒
記録中の離脱警告：beforeunload（ページ離脱で注意）
F. コース判定
オフコース簡易判定（30m/60mしきい値）を継続
バッジ表示：ON COURSE / 注意 / ルート外
G. 後方互換・導線
既存のlocalStorageログがあれば起動時にIndexedDBへ移行（一度だけ）
保存成功時はトースト＋ホーム遷移
失敗時はわかりやすいエラートースト（容量超過など）
将来（別フェーズで入れるもの・ここでは実装しない）
マップマッチング（Mapbox/OSRM）→ Pro機能候補
写真添付／OGPサムネ自動生成
ルート新規作成の道路スナップ
クラウド保存／同期、公開範囲（公開/限定/非公開）



















